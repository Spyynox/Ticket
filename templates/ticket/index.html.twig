{% extends 'base.html.twig' %}

{% block title %}Ticket index{% endblock %}

{% block body %}
    <div class="ticket">
        <h1>Ticket(s) reçu(s)</h1>
    </div>

    {% if app.user %}
        {% if is_granted('ROLE_ADMIN') %}
            <table class="table">
                <thead>
                    <tr>
                        <th>Titre</th>
                        <th>Contenu de votre ticket</th>
                        <th>Envoyer le</th>
                        <th>Pseudo</th>
                        <th>Modifier</th>
                        <th>Supprimer</th>
                    </tr>
                </thead>
                <tbody>
                {% for ticket in tickets %}
                    <tr>
                        <td>{{ ticket.title }}</td>
                        <td>{{ ticket.text }}</td>
                        <td>{{ ticket.createdAt ? ticket.createdAt|date('d-m-Y à H:i') : '' }}</td>
                        <td>{{ ticket.user}}</td>
                        <td class="edit">
                            <a href="{{ path('ticket_edit', {'id': ticket.id}) }}">Modifier</a>
                        </td>
                        <td class="delete">
                            <a href="{{ path('ticket_delete', {'id': ticket.id}) }}">Supprimer</a>
                        </td>
                    </tr>
                {% else %}
                    <tr>
                        <td colspan="5">Aucun ticket trouvé</td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        {% endif %}

        {% if is_granted('ROLE_USER') %}
            <table class="table">
                <thead>
                    <tr>
                        <th>Titre</th>
                        <th>Contenu de votre ticket</th>
                        <th>Envoyer le</th>
                        <th>Pseudo</th>
                    </tr>
                </thead>
                <tbody>
                {% for ticket in tickets %}
                    {% if ticket.user == app.user %}
                        <tr>
                            <td>{{ ticket.title }}</td>
                            <td>{{ ticket.text }}</td>
                            <td>{{ ticket.createdAt ? ticket.createdAt|date('d-m-Y à H:i') : '' }}</td>
                            <td>{{ ticket.user}}</td>
                        </tr>
                    {% endif %}
                {% else %}
                    <tr>
                        <td colspan="5">Aucun ticket trouvé</td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        {% endif %}

            <a href="{{ path('ticket_new') }}">Créer un nouveau ticket</a>
    {% endif %}

    

    {% if not app.user %}
        Pour voir vos tickets, <a href="{{ path('app_login') }}">connectez-vous</a> ou <a href="{{ path('app_register') }}">inscrivez-vous</a>!
    {% endif %}



        

{% endblock %}

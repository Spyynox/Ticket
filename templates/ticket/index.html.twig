{% extends 'base.html.twig' %}

{% block title %}Ticket index{% endblock %}

{% block body %}
    <div class="ticket">
        <h1>Ticket(s) reçu(s)</h1>
    </div>

    {% if app.user %}
        {% if is_granted('ROLE_ADMIN') %}
            <table class="table">
                <thead>
                    <tr>
                        <th>Titre</th>
                        <th>Personne assigné</th>
                        <th>Origine du ticket</th>
                        <th>Envoyer le</th>
                        <th>Voir les détails</th>
                        <th>Modifier</th>
                        <th>Supprimer</th>
                    </tr>
                </thead>
                <tbody>
                {% for ticket in tickets %}
                {% for user in users %}
                    {% if ticket.user == user %}
                        <tr>
                            <td>{{ ticket.title }}</td>
                            <td>{{ user.username }}</td>
                            <td>{{ ticket.currentuser }}</td>
                            <td>{{ ticket.createdAt ? ticket.createdAt|date('d-m-Y à H:i') : '' }}</td>
                            <td class="edit">
                                <a href="{{ path('ticket_show', {'id': ticket.id}) }}">Détails</a>
                            </td>
                            <td class="edit">
                                <a href="{{ path('ticket_edit', {'id': ticket.id}) }}">Modifier</a>
                            </td>
                            <td class="delete">
                                <a href="{{ path('ticket_delete', {'id': ticket.id}) }}">Supprimer</a>
                            </td>
                        </tr>
                    {% endif %}
                {% endfor %}
                {% endfor %}
                </tbody>
            </table>
        {% endif %}

        {% if is_granted('ROLE_USER') %}
            <table class="table">
                <thead>
                    <tr>
                        <th>Titre</th>
                        <th>Envoyer le</th>
                        <th class="textMessage">Message(s)</th>
                    </tr>
                </thead>
                <tbody>
                {% for ticket in tickets %}
                {% for user in users %}
                    {% if ticket.currentuser == app.user.username or ticket.user == app.user.username %}
                    {% if ticket.user == user %}
                        <tr>
                            <td>{{ ticket.title }}</td>
                            <td>{{ ticket.createdAt ? ticket.createdAt|date('d-m-Y à H:i') : '' }}</td><td class="edit">
                                <a href="{{ path('ticket_show', {'id': ticket.id}) }}" class="textMessage">Voir/Créer vos messages</a>
                            </td>
                        </tr>
                    {% endif %}
                    {% endif %}
                {% endfor %}
                {% endfor %}
                </tbody>
            </table>
        {% endif %}

            <a href="{{ path('ticket_new') }}">Créer un nouveau ticket</a>
    {% endif %}

    

    {% if not app.user %}
        Pour voir vos tickets, <a href="{{ path('app_login') }}">connectez-vous</a> ou <a href="{{ path('app_register') }}">inscrivez-vous</a>!
    {% endif %}



        

{% endblock %}
